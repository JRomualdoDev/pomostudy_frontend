<div class="space-y-4 m-6 p-6">
  <div class="task-form-container-horizontal">
    <form (ngSubmit)="submitTask()" autocomplete="off" class="task-form-horizontal">
      <div class="form-row">
        <input class="input" name="name" [(ngModel)]="task.name" placeholder="Name" required />
        <input class="input" name="description" [(ngModel)]="task.description" placeholder="Description" />
        <input class="input" type="date" name="startDate" [(ngModel)]="task.startDate" placeholder="Start Date" />
        <input class="input" type="date" name="endDate" [(ngModel)]="task.endDate" placeholder="End Date" />
        <select class="input" name="status" [(ngModel)]="task.status" required>
          <option value="" disabled>Status</option>
          <option value="PENDING">Pending</option>
          <option value="IN_PROGRESS">In Progress</option>
          <option value="COMPLETED">Completed</option>
          <option value="CANCELED">Canceled</option>
        </select>
        <select class="input" name="priority" [(ngModel)]="task.priority" required>
          <option value="" disabled>Priority</option>
          <option value="LOW">Low</option>
          <option value="MEDIUM">Medium</option>
          <option value="HIGH">High</option>
        </select>
        <input class="input" type="number" name="timeTotalLearning" [(ngModel)]="task.timeTotalLearning" placeholder="Total Learning Time" />
        <select class="input" name="categoryId" [(ngModel)]="task.categoryId" required>
          <option value="" disabled>Category</option>
          @for (cat of uniqueCategories; track cat.id) {
            <option [ngValue]="cat.id">{{ cat.name }}</option>
          }
        </select>
        <button type="button" z-button zType="ghost" (click)="showCategoryForm = !showCategoryForm" style="min-width:120px;">
          + New Category
        </button>
        <button type="submit" z-button zType="secondary" style="min-width:120px;">Save Task</button>
      </div>
      @if (showCategoryForm) {
        <div class="category-form-horizontal">
          <input class="input" name="catName" [(ngModel)]="category.name" placeholder="Category Name" />
          <input class="input" name="catColor" [(ngModel)]="category.color" placeholder="Color (hex)" />
          <input class="input" name="catIcon" [(ngModel)]="category.icon" placeholder="Icon (class or image)" />
          <button type="button" z-button zType="secondary" (click)="submitCategory()">Save Category</button>
        </div>
      }
      @if (message) {
        <div class="msg">{{ message }}</div>
      }
    </form>
  </div>

  <div class="task-table-container">
    <div class="form-field" style="max-width: 300px; margin-bottom: 16px;">
      <label>Show tasks for category:</label>
      <select class="input" [(ngModel)]="selectedCategoryId" (change)="onCategorySelect()" name="selectedCategoryId">
        <option value="" disabled>Select Category</option>
        @for (cat of uniqueCategories; track cat.id) {
          <option [ngValue]="cat.id">{{ cat.name }}</option>
        }
      </select>
    </div>
    @if (categoryTasks.length > 0) {
      <table class="elegant-table">
        <thead>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Description</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Total Learning Time</th>
          </tr>
        </thead>
        <tbody>
          @for (task of categoryTasks; track task.id) {
            <tr>
              <td>
                <button z-button zType="ghost" class="play-btn" (click)="openPomodoro(task)">
                  <i class="icon-play"></i>
                </button>
              </td>
              <td>{{ task.name }}</td>
              <td>{{ task.description }}</td>
              <td>{{ task.startDate }}</td>
              <td>{{ task.endDate }}</td>
              <td>{{ task.status }}</td>
              <td>{{ task.priority }}</td>
              <td>{{ task.timeTotalLearning }}</td>
            </tr>
          }
        </tbody>
      </table>
    }
    @if (selectedCategoryId && categoryTasks.length === 0) {
      <div class="msg">
        No tasks found for this category.
      </div>
    }
  </div>

  <!-- Pomodoro Fullscreen Popup -->
  @if (showPomodoro) {
    <div class="pomodoro-fullscreen">
      <app-pomodoro [task]="pomodoroTask" (close)="closePomodoro()"></app-pomodoro>
    </div>
  }
</div>
